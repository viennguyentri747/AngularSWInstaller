<!-- Include Bootstrap CSS for styling -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
<div class="container">
    <div class="row justify-content-center">
        <div class="col-auto">
            <h2>File Upload and Installation</h2>

            <!-- Tab Navigation -->
            <ul class="nav nav-tabs" id="fileTab" role="tablist">
                <li class="nav-item">
                    <!-- Angular handles the class switch and click event -->
                    <a [ngClass]="currentTab == 'existing' ? 'nav-link active' : 'nav-link'"
                        (click)="onSelectInstallSourceTab('existing')">From Existing Files</a>
                </li>
                <li class="nav-item">
                    <!-- Angular handles the class switch and click event -->
                    <a [ngClass]="currentTab == 'computer' ? 'nav-link active' : 'nav-link'"
                        (click)="onSelectInstallSourceTab('computer')">From My Computer</a>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="myTabContent">
                <!-- From Existing Files content -->
                <div [ngClass]="currentTab == 'existing' ? 'tab-pane fade show active' : 'tab-pane fade'">

                    <!-- Check if there are files available -->
                    <div *ngIf="existingFileNames.length > 0; else noFilesTemplate">
                        <label for="existingFiles" class="form-label mt-3">Choose an existing file:</label>
                        <select id="existingFiles" class="custom-select" [(ngModel)]="selectedInstallFile"
                            (ngModelChange)="onSelectFileForInstall(selectedInstallFile)">
                            <option *ngFor="let file of existingFileNames" [value]="file">{{ file }}</option>
                        </select>
                    </div>

                    <!-- Template to display when no files are available -->
                    <ng-template #noFilesTemplate>
                        <div class="alert alert-secondary mt-3" style="padding: 20px; text-align: center;">
                            <strong>No files available</strong>
                            <p style="margin-top: 10px;">Please upload files to proceed with installation.</p>
                        </div>
                    </ng-template>

                </div>

                <!-- From Computer content -->
                <div [ngClass]="currentTab == 'computer' ? 'tab-pane fade show active' : 'tab-pane fade'" id="computer">
                    <input type="file" class="form-control-file mt-3" (change)="onSelectFileForUpload($event)"
                        #fileUploadInput>

                    <p *ngIf="selectedUploadFile" class="mt-1">
                        <strong>File Size:</strong> {{ selectedUploadFile.size | fileSize }}
                    </p>

                    <button class="btn btn-primary mt-2" (click)="uploadFile(selectedUploadFile)"
                        *ngIf="selectedUploadFile && !isUploading">Upload</button>
                    <div class="progress mt-2" *ngIf="isUploading">
                        <div class="progress-bar bg-success progress-bar-striped progress-bar-animated"
                            role="progressbar" [style.width.%]="uploadProgress" aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Choose file to install -->
            <div *ngIf="selectedInstallFile && hasUtInfos()" class="tab-content">
                <div class="mt-3">
                    <strong>Choosen file for install:</strong> {{ selectedInstallFile }}<br>
                </div>
            </div>
            
            <!-- Table for UT Infos -->
            <table class="table table-fixed-horizontal">
                <thead>
                    <tr>
                        <th id="ip-col">UT IP</th>
                        <th id="status-col">Status</th>
                        <th id="progress-col">Install Log</th>
                        <th id="install-col">Install</th> <!-- New column for install button -->
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let ut of utInfosByIp | keyvalue">
                        <td id="ip-col">{{ ut.value.ip }}</td>
                        <td id="status-col">{{ ut.value.status }}</td>
                        <td id="progress-col"
                            title="{{ utLogsByIp[ut.value.ip] ? utLogsByIp[ut.value.ip] : 'Unknown' }}">
                            {{ utLogsByIp[ut.value.ip] || 'No Data' }}
                        </td>
                        <td id="install-col">
                            <button class="btn btn-primary"
                                (click)="selectedInstallFile && installFile(selectedInstallFile, ut.value.ip)"
                                [disabled]="ut.value.status !== 'Idle' || !selectedInstallFile">Install</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>