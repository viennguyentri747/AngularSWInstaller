<!-- Include Bootstrap CSS for styling -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">

<div class="container">
    <div class="row justify-content-center">
        <div class="col-auto">
            <h2>File Upload and Installation</h2>

            <!-- Tab Navigation -->
            <ul class="nav nav-tabs" id="fileTab" role="tablist">
                <li class="nav-item">
                    <!-- Angular handles the class switch and click event -->
                    <a [ngClass]="currentTab == 'existing' ? 'nav-link active' : 'nav-link'"
                        (click)="onSelectInstallSourceTab('existing')">From Existing Files</a>
                </li>
                <li class="nav-item">
                    <!-- Angular handles the class switch and click event -->
                    <a [ngClass]="currentTab == 'computer' ? 'nav-link active' : 'nav-link'"
                        (click)="onSelectInstallSourceTab('computer')">From My Computer</a>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="myTabContent">
                <!-- From Existing Files content -->
                <div [ngClass]="currentTab == 'existing' ? 'tab-pane fade show active' : 'tab-pane fade'">

                    <!-- Check if there are files available -->
                    <div *ngIf="existingFileNames.length > 0; else noFilesTemplate">
                        <label for="existingFiles" class="form-label mt-3">Choose an existing file:</label>
                        <select id="existingFiles" class="custom-select" [(ngModel)]="selectedInstallFile"
                            (ngModelChange)="onSelectFileForInstall(selectedInstallFile)">
                            <option *ngFor="let file of existingFileNames" [value]="file">{{ file }}</option>
                        </select>
                    </div>

                    <!-- Template to display when no files are available -->
                    <ng-template #noFilesTemplate>
                        <div class="alert alert-secondary mt-3" style="padding: 20px; text-align: center;">
                            <strong>No files available</strong>
                            <p style="margin-top: 10px;">Please upload files to proceed with installation.</p>
                        </div>
                    </ng-template>

                </div>

                <!-- From Computer content -->
                <div [ngClass]="currentTab == 'computer' ? 'tab-pane fade show active' : 'tab-pane fade'" id="computer">
                    <input type="file" class="form-control-file mt-3" (change)="onSelectFileForUpload($event)"
                        #fileUploadInput>

                    <p *ngIf="selectedUploadFile" class="mt-1">
                        <strong>File Size:</strong> {{ selectedUploadFile.size | fileSize }}
                    </p>

                    <button class="btn btn-primary mt-2" (click)="uploadSelectedFile()"
                        *ngIf="selectedUploadFile && !isUploading">Upload</button>
                    <div class="progress mt-2" *ngIf="uploadProgress > 0 && uploadProgress < 100">
                        <div class="progress-bar bg-success progress-bar-striped progress-bar-animated"
                            role="progressbar" [style.width.%]="uploadProgress" aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                    <p *ngIf="uploadProgress == 100" class="text-success">Upload Complete! File {{ selectedInstallFile
                        }} ready for installation.
                    </p>
                </div>
            </div>

            <div *ngIf="selectedInstallFile && availableUtIps.length > 0" class="tab-content">
                <div class="mt-3">
                    <strong>Chosen file:</strong> {{ selectedInstallFile }}<br>
                </div>

                <div class="mt-3">
                    <label for="availableUts" class="form-label">Choose a UT for installation: </label>

                    
                    <select id="availableUts" class="custom-select" [(ngModel)]="selectedUtIp"
                        (ngModelChange)="onSelectUt(selectedUtIp)">
                        <option *ngFor="let utIp of availableUtIps" [value]="utIp">{{ utIp }}</option>
                    </select>
                </div>

                <div class="mt-4">
                    <button class="btn btn-primary" (click)="installFile()" *ngIf="selectedUtIp">Run Install</button>
                </div>
            </div>


        </div>
    </div>
</div>